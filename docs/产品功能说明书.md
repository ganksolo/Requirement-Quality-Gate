# ReqGate 产品功能说明书

> 📖 **本文档面向产品经理和非技术人员**，用通俗易懂的语言解释 ReqGate 系统的功能模块、它们之间的关系，以及每个开发阶段的目的。

---

## 📌 一、ReqGate 是什么？

**ReqGate（需求质量门禁）** 是一个 **AI 智能助手**，专门用来检查产品需求文档（PRD）的质量。

### 用一句话概括

> 📝 PM 写完需求 → ReqGate 自动检查 → 告诉你哪里写得不好、怎么改

### 它解决什么问题？

| 问题 | ReqGate 的解决方案 |
|------|-------------------|
| PRD 写得太模糊，开发看不懂 | AI 自动识别模糊表述，给出修改建议 |
| 缺少验收标准（AC），导致需求理解偏差 | 自动检测是否缺少 AC，强制要求补充 |
| 需求评审会上浪费时间讨论低质量需求 | **在评审前自动拦截**，只有合格需求才能进入评审 |
| PM 不知道需求写得好不好 | 给出 **量化评分**（0-100分），让质量可衡量 |

---

## 📌 二、系统整体工作流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        ReqGate 工作流程                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   📝 输入需求          🔍 检查流程                    📊 输出结果        │
│                                                                          │
│   ┌─────────┐     ┌─────────────────────────┐      ┌─────────────┐      │
│   │ PM 写的 │     │ 1. 安全检查             │      │ ✅ 通过      │      │
│   │ 需求文档│ ──▶ │ 2. 智能结构化           │ ──▶  │ 进入评审    │      │
│   │（PRD）  │     │ 3. 格式验证             │      ├─────────────┤      │
│   └─────────┘     │ 4. AI 评分              │      │ ❌ 拒绝      │      │
│                   │ 5. 门禁判定             │      │ 返回修改    │      │
│                   └─────────────────────────┘      └─────────────┘      │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📌 三、Phase 1 - 基础评分系统

### 🎯 这个阶段做了什么？

**Phase 1 是系统的"地基"**，搭建了最核心的评分和拦截能力。

### 📦 功能模块清单

| 模块名称 | 通俗解释 | 作用 |
|---------|---------|------|
| **输入标准化** | 把各种格式的需求统一成标准格式 | 无论 PM 用什么方式写需求，系统都能处理 |
| **评分规则配置** | 一套评分标准（类似考试大纲） | 定义什么是好需求、什么是坏需求 |
| **AI 评分引擎** | 让 AI 阅读需求并打分 | 核心评分逻辑，产出 0-100 分 |
| **门禁决策器** | 根据评分决定"放行"还是"拦截" | 60 分以下 → 拒绝，60 分以上 → 通过 |
| **评分报告生成** | 生成详细的评价报告 | 告诉 PM 哪里扣分、怎么改进 |

### 🔗 模块依赖关系图

```
┌──────────────────────────────────────────────────────────────┐
│                     Phase 1 模块依赖图                        │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│   ┌─────────────┐                                             │
│   │ 输入标准化   │ ◀─── PM 提交的原始需求                      │
│   └──────┬──────┘                                             │
│          │ 标准化后的需求数据                                  │
│          ▼                                                    │
│   ┌─────────────┐      ┌─────────────┐                        │
│   │ 评分规则配置 │ ◀────│ 规则文件    │                        │
│   │ (评分标准)  │      │(YAML 配置)  │                        │
│   └──────┬──────┘      └─────────────┘                        │
│          │ 提供评分标准                                        │
│          ▼                                                    │
│   ┌─────────────┐                                             │
│   │ AI 评分引擎 │ ◀─── 调用 AI 大模型                          │
│   │ (核心打分)  │                                             │
│   └──────┬──────┘                                             │
│          │ 评分结果 (0-100分)                                  │
│          ▼                                                    │
│   ┌─────────────┐      ┌─────────────┐                        │
│   │ 门禁决策器  │ ────▶│ 评分报告    │                         │
│   │ (通过/拒绝) │      │ (详细反馈)  │                         │
│   └─────────────┘      └─────────────┘                        │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

### ❓ 为什么要先做 Phase 1？

| 原因 | 解释 |
|------|------|
| **验证核心价值** | 先证明 AI 评分这条路走得通，再扩展功能 |
| **最小可用产品** | 只用这些模块，就能跑通"输入需求 → 打分 → 拦截"的完整流程 |
| **技术风险控制** | AI 评分是最大的技术不确定性，需要优先验证 |

---

## 📌 四、Phase 2 - 智能结构化与工作流

### 🎯 这个阶段做了什么？

**Phase 2 让系统更"聪明"**，能够理解杂乱的需求文本，并自动整理成结构化格式。

### 📦 功能模块清单

| 模块名称 | 通俗解释 | 作用 |
|---------|---------|------|
| **输入安全检查** | 检查需求是否包含敏感信息或恶意内容 | 防止隐私泄露、防止 AI 被攻击 |
| **智能结构化** | 把杂乱的文字整理成标准格式 | 即使 PM 写的是会议纪要，也能提取出标准 PRD |
| **结构完整性检查** | 检查结构化后的需求是否完整 | 确保有标题、用户故事、验收标准等必要内容 |
| **降级容错机制** | 结构化失败时的备用方案 | 保证系统不会因为 AI 出错而崩溃 |
| **工作流编排** | 把所有模块串联成自动化流水线 | 一键触发，全自动执行 |
| **重试机制** | AI 调用失败时自动重试 | 提高系统稳定性 |

### 🔗 模块依赖关系图

```
┌────────────────────────────────────────────────────────────────────────┐
│                    Phase 2 完整工作流依赖图                             │
├────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   📥 输入                                                               │
│   ┌─────────────┐                                                       │
│   │ PM 写的需求  │                                                       │
│   └──────┬──────┘                                                       │
│          │                                                              │
│          ▼                                                              │
│   ┌─────────────┐     ┌─────────────┐                                   │
│   │ 输入安全检查 │ ◀───│ 安全规则    │  🛡️ 第 1 道关卡                   │
│   │ (Guardrail) │     │ 配置文件    │  检查敏感信息、恶意注入            │
│   └──────┬──────┘     └─────────────┘                                   │
│          │ ✅ 通过安全检查                                               │
│          ▼                                                              │
│   ┌─────────────┐     ┌─────────────┐                                   │
│   │ 智能结构化   │ ◀───│ 结构化提示词 │  🤖 AI 智能提取                   │
│   │(Structuring)│     │ (Prompt)    │  把会议纪要变成标准 PRD            │
│   └──────┬──────┘     └─────────────┘                                   │
│          │                                                              │
│          ├─────────────────────┐                                        │
│          │ ✅ 结构化成功       │ ❌ 结构化失败                           │
│          ▼                     ▼                                        │
│   ┌─────────────┐       ┌─────────────┐                                 │
│   │ 结构完整性   │       │ 降级容错    │  ⚠️ 备用方案                     │
│   │ 检查        │       │ (Fallback)  │  使用原始文本继续评分             │
│   │(Hard Check) │       │ -5分惩罚    │                                  │
│   └──────┬──────┘       └──────┬──────┘                                 │
│          │                     │                                        │
│          └──────────┬──────────┘                                        │
│                     ▼                                                   │
│             ┌─────────────┐                                             │
│             │ AI 评分引擎 │  📊 来自 Phase 1                             │
│             │ (复用)      │                                             │
│             └──────┬──────┘                                             │
│                    ▼                                                    │
│             ┌─────────────┐                                             │
│             │ 门禁决策器  │  🚦 来自 Phase 1                             │
│             │ (复用)      │                                             │
│             └──────┬──────┘                                             │
│                    ▼                                                    │
│   📤 输出  ┌─────────────┐                                              │
│            │ ✅ 通过 / ❌ 拒绝 + 修改建议                                 │
│            └─────────────┘                                              │
│                                                                         │
└────────────────────────────────────────────────────────────────────────┘
```

### ❓ 为什么要做 Phase 2？

| 原因 | 解释 |
|------|------|
| **适应真实场景** | PM 写的需求通常不是标准格式，可能是会议纪要、聊天记录等 |
| **提升容错能力** | 即使某个环节出错，系统也能继续运行，不会直接崩溃 |
| **增强安全性** | 防止敏感信息泄露、防止 AI 被恶意攻击 |
| **为集成做准备** | Phase 3 需要对接 Jira 等外部系统，必须先有稳定的内部流程 |

---

## 📌 五、Phase 3 - 集成与对外开放（计划中）

### 🎯 这个阶段要做什么？

**Phase 3 让系统能够被外部调用**，与企业现有工具（如 Jira）打通。

### 📦 计划功能模块

| 模块名称 | 通俗解释 | 作用 |
|---------|---------|------|
| **API 接口** | 对外暴露调用入口 | 让其他系统能调用 ReqGate 的评分能力 |
| **Jira 集成** | 与 Jira 系统对接 | 在 Jira 创建需求时自动触发检查 |
| **报告格式化** | 把评分报告转成友好格式 | 生成 PM 容易阅读的 Markdown 报告 |
| **自动回写** | 把评审结果写回 Jira | PM 在 Jira 中直接看到评价和修改建议 |

### 🔗 Phase 3 的位置

```
┌────────────────────────────────────────────────────────────────────┐
│                      系统架构分层                                   │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────────────────────────────────┐                       │
│   │  Phase 3: 集成层 (对外接口)              │ ◀── Jira / n8n      │
│   │  - API 接口                             │                      │
│   │  - Jira 适配器                          │                      │
│   │  - 报告格式化                           │                      │
│   ├─────────────────────────────────────────┤                       │
│   │  Phase 1 & 2: 核心服务层 (内部逻辑)       │                       │
│   │  - 输入处理                             │                      │
│   │  - 智能结构化                           │                      │
│   │  - AI 评分                              │                      │
│   │  - 门禁决策                             │                      │
│   ├─────────────────────────────────────────┤                       │
│   │  基础设施层 (底层支撑)                   │                       │
│   │  - AI 大模型 (DeepSeek / Gemini)        │                       │
│   │  - 数据库 (Phase 4)                     │                       │
│   └─────────────────────────────────────────┘                       │
│                                                                     │
└────────────────────────────────────────────────────────────────────┘
```

### ❓ 为什么要做 Phase 3？

| 原因 | 解释 |
|------|------|
| **融入现有工作流** | PM 每天都用 Jira，不希望切换到新工具 |
| **降低使用门槛** | 自动触发检查，PM 无需手动操作 |
| **即时反馈** | 评审结果直接显示在 Jira 评论中 |
| **规模化使用** | 有了 API，可以接入更多系统（飞书、钉钉等） |

---

## 📌 六、Phase 4 - 运维与智能优化（计划中）

### 🎯 这个阶段要做什么？

**Phase 4 让系统能够长期稳定运行**，并且越用越"聪明"。

### 📦 计划功能模块

| 模块名称 | 通俗解释 | 作用 |
|---------|---------|------|
| **数据持久化** | 保存历史评审记录 | 可以回溯、统计、分析 |
| **监控与追踪** | 监控系统运行状态 | 发现问题及时告警 |
| **黄金测试集** | 40个标准测试样本 | 确保每次更新不会"变笨" |
| **反馈闭环** | PM 可以标记"误判" | AI 根据反馈持续学习优化 |
| **性能优化** | 提升响应速度 | 从 30 秒压缩到 10 秒 |

### ❓ 为什么要做 Phase 4？

| 原因 | 解释 |
|------|------|
| **生产级要求** | 真正上线需要稳定性和可观测性 |
| **持续改进** | 通过反馈让系统越来越准确 |
| **数据积累** | 历史数据可以用于培训、统计、分析 |
| **误判修正** | PM 可以纠正 AI 的错误判断 |

---

## 📌 七、各阶段之间的关系

```
┌─────────────────────────────────────────────────────────────────────┐
│                    四个阶段的递进关系                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   Phase 1                Phase 2                                     │
│   基础评分               智能结构化                                   │
│   ┌────────┐            ┌────────┐                                   │
│   │ 能打分 │ ─────────▶ │ 更聪明 │                                   │
│   │ 能拦截 │            │ 能理解 │                                   │
│   │        │            │ 杂乱文本│                                   │
│   └────────┘            └────────┘                                   │
│        │                      │                                      │
│        │    ✅ 已完成          │    ✅ 已完成                          │
│        │                      │                                      │
│        └──────────┬───────────┘                                      │
│                   │                                                  │
│                   ▼                                                  │
│   Phase 3                Phase 4                                     │
│   对外集成               运维优化                                     │
│   ┌────────┐            ┌────────┐                                   │
│   │ 能对接 │ ─────────▶ │ 更稳定 │                                   │
│   │ Jira等 │            │ 更精准 │                                   │
│   │ 外部系统│            │ 可追溯 │                                   │
│   └────────┘            └────────┘                                   │
│        │                      │                                      │
│        │    ⏳ 待开发          │    ⏳ 待开发                          │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 为什么按这个顺序开发？

| 阶段 | 前置依赖 | 价值增量 |
|------|---------|---------|
| **Phase 1** | 无 | 验证核心价值：AI 能否准确评分 |
| **Phase 2** | Phase 1 | 提升易用性：能处理非标准输入 |
| **Phase 3** | Phase 2 | 融入工作流：无需改变 PM 习惯 |
| **Phase 4** | Phase 3 | 生产化运营：稳定、可维护、可优化 |

---

## 📌 八、关键术语对照表

| 英文术语 | 中文翻译 | 解释 |
|---------|---------|------|
| RequirementPacket | 需求数据包 | 标准化后的需求输入格式 |
| TicketScoreReport | 评分报告 | 包含分数、问题列表、修改建议 |
| ScoringAgent | 评分代理 | 调用 AI 进行评分的模块 |
| HardGate | 硬性门禁 | 根据规则决定通过/拒绝的模块 |
| RubricLoader | 规则加载器 | 读取评分规则配置的模块 |
| Guardrail | 安全护栏 | 输入安全检查模块 |
| StructuringAgent | 结构化代理 | 把杂乱文本变成标准 PRD 的模块 |
| PRD_Draft | PRD 草案 | 结构化后的需求文档 |
| Fallback | 降级/备用 | 出错时的备用处理方案 |
| LangGraph | 工作流引擎 | 把多个模块串联成流水线的技术框架 |

---

## 📌 九、总结

### ✅ 已完成的能力 (Phase 1 + 2)

1. ✅ 自动评分 (0-100分)
2. ✅ 自动拦截低质量需求 (<60分)
3. ✅ 生成详细的修改建议
4. ✅ 处理非标准格式的需求文本
5. ✅ 防止敏感信息泄露
6. ✅ 系统出错时自动降级，不会崩溃

### ⏳ 即将开发的能力 (Phase 3 + 4)

1. ⏳ Jira 集成（自动触发检查）
2. ⏳ API 接口（对接其他系统）
3. ⏳ 历史记录保存
4. ⏳ 误判反馈修正
5. ⏳ 性能优化

---

**文档版本**: v1.0  
**更新日期**: 2026-02-04  
**当前进度**: Phase 1 & 2 已完成，Phase 3 待启动
